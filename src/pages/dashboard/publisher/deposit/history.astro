---
import DashboardLayout from "../../../../layouts/DashboardLayout.astro";

// Mock Data (Shared with Index logic, ideally moved to a store/utils)
const depositHistory = Array.from({ length: 20 }).map((_, i) => ({
    id: `DEP-${20000 + i}`,
    method: [
        "QRIS",
        "BCA VA",
        "Mandiri VA",
        "BRI VA",
        "Dana",
        "OVO",
        "ShopeePay",
    ][Math.floor(Math.random() * 7)],
    amount: (Math.floor(Math.random() * 20) + 1) * 50000,
    date: new Date(
        Date.now() - Math.floor(Math.random() * 1000 * 60 * 60 * 24 * 30),
    ).toLocaleDateString("id-ID", {
        day: "numeric",
        month: "short",
        year: "numeric",
    }),
    status: ["success", "pending", "failed"][
        Math.floor(Math.random() * (i < 5 ? 2 : 3))
    ],
}));

function getMethodColorBg(method: string) {
    if (
        method.includes("BCA") ||
        method.includes("Mandiri") ||
        method.includes("BRI") ||
        method.includes("VA")
    )
        return "bg-blue-50 text-blue-600";
    if (method.includes("Dana")) return "bg-sky-50 text-sky-600";
    if (method.includes("OVO")) return "bg-purple-50 text-purple-600";
    if (method.includes("GoPay")) return "bg-emerald-50 text-emerald-600";
    if (method.includes("Shopee")) return "bg-orange-50 text-orange-600";
    return "bg-gray-100 text-gray-600";
}

function getMethodIcon(method: string) {
    if (method.includes("VA") || method.includes("Bank"))
        return `<i class="fa-solid fa-building-columns text-lg"></i>`;
    if (method.includes("QRIS"))
        return `<i class="fa-solid fa-qrcode text-lg"></i>`;
    return `<i class="fa-solid fa-wallet text-lg"></i>`;
}

function getStatusBadge(status: string) {
    if (status === "success")
        return `<span class="inline-flex items-center gap-1.5 text-[10px] font-bold text-emerald-700 bg-emerald-50 px-2.5 py-1 rounded-full border border-emerald-100"><i class="fa-solid fa-check-circle text-[10px]"></i>Berhasil</span>`;
    if (status === "pending")
        return `<span class="inline-flex items-center gap-1.5 text-[10px] font-bold text-amber-700 bg-amber-50 px-2.5 py-1 rounded-full border border-amber-100"><i class="fa-solid fa-clock text-[10px] animate-pulse"></i>Proses</span>`;
    return `<span class="inline-flex items-center gap-1.5 text-[10px] font-bold text-red-700 bg-red-50 px-2.5 py-1 rounded-full border border-red-100"><i class="fa-solid fa-circle-xmark text-[10px]"></i>Gagal</span>`;
}
---

<DashboardLayout title="Riwayat Deposit">
    <!-- Header -->
    <div
        class="mb-8 flex flex-col md:flex-row md:items-end justify-between gap-4"
    >
        <div>
            <h1 class="text-2xl font-bold text-gray-800 tracking-tight">
                Riwayat Deposit
            </h1>
            <p class="text-gray-500 text-sm mt-1">
                Pantau semua transaksi deposit masuk Anda disini.
            </p>
        </div>
        <div class="flex gap-3">
            <a
                href="/dashboard/publisher/deposit"
                class="px-5 py-2.5 rounded-xl bg-[#ff6b6b] text-white font-bold text-sm hover:bg-[#e55a5a] transition-all flex items-center gap-2 shadow-lg shadow-red-100 hover:shadow-red-200"
            >
                <i class="fa-solid fa-plus"></i>
                Deposit Baru
            </a>
            <button
                class="px-5 py-2.5 rounded-xl bg-white text-gray-700 font-bold text-sm hover:bg-gray-50 transition-all flex items-center gap-2 border border-gray-200 hover:border-gray-300 shadow-sm"
            >
                <i class="fa-solid fa-download"></i>
                Export CSV
            </button>
        </div>
    </div>

    <!-- Main Card -->
    <div class="soft-card p-6 md:p-8 border border-gray-100">
        <div class="overflow-x-auto hidden md:block">
            <table class="w-full">
                <thead>
                    <tr class="text-left border-b border-gray-100">
                        <th
                            class="pb-4 text-xs font-bold text-gray-400 uppercase tracking-wider"
                            >ID Transaksi</th
                        >
                        <th
                            class="pb-4 text-xs font-bold text-gray-400 uppercase tracking-wider"
                            >Metode</th
                        >
                        <th
                            class="pb-4 text-xs font-bold text-gray-400 uppercase tracking-wider"
                            >Tanggal</th
                        >
                        <th
                            class="pb-4 text-xs font-bold text-gray-400 uppercase tracking-wider text-right"
                            >Nominal</th
                        >
                        <th
                            class="pb-4 text-xs font-bold text-gray-400 uppercase tracking-wider text-right"
                            >Status</th
                        >
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-50">
                    {
                        depositHistory.map((item) => (
                            <tr class="group hover:bg-gray-50/80 transition-colors">
                                <td class="py-4 font-mono text-xs text-gray-500 group-hover:text-gray-800 transition-colors">
                                    #{item.id}
                                </td>
                                <td class="py-4">
                                    <div class="flex items-center gap-3">
                                        <div
                                            class={`w-8 h-8 rounded-lg ${getMethodColorBg(item.method)} flex items-center justify-center`}
                                        >
                                            <Fragment
                                                set:html={getMethodIcon(
                                                    item.method,
                                                )}
                                            />
                                        </div>
                                        <span class="font-bold text-sm text-gray-800">
                                            {item.method}
                                        </span>
                                    </div>
                                </td>
                                <td class="py-4 text-sm font-medium text-gray-500">
                                    {item.date}
                                </td>
                                <td class="py-4 text-right font-black text-sm text-gray-800">
                                    + Rp{" "}
                                    {new Intl.NumberFormat("id-ID").format(
                                        item.amount,
                                    )}
                                </td>
                                <td class="py-4 text-right">
                                    <div class="flex justify-end">
                                        <Fragment
                                            set:html={getStatusBadge(
                                                item.status,
                                            )}
                                        />
                                    </div>
                                </td>
                            </tr>
                        ))
                    }
                </tbody>
            </table>
        </div>

        <!-- Mobile Card View -->
        <div class="md:hidden space-y-4">
            {
                depositHistory.map((item) => (
                    <div class="p-4 rounded-xl border border-gray-100 bg-gray-50/30 hover:bg-gray-50 transition-all">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex items-center gap-3">
                                <div
                                    class={`w-10 h-10 rounded-xl ${getMethodColorBg(item.method)} flex items-center justify-center`}
                                >
                                    <Fragment
                                        set:html={getMethodIcon(item.method)}
                                    />
                                </div>
                                <div>
                                    <h4 class="font-bold text-sm text-gray-800">
                                        {item.method}
                                    </h4>
                                    <p class="text-[10px] text-gray-400 font-mono">
                                        #{item.id}
                                    </p>
                                </div>
                            </div>
                            <Fragment set:html={getStatusBadge(item.status)} />
                        </div>
                        <div class="flex items-end justify-between border-t border-gray-200/50 pt-3">
                            <div>
                                <p class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-0.5">
                                    Nominal
                                </p>
                                <p class="font-black text-base text-gray-800">
                                    Rp{" "}
                                    {new Intl.NumberFormat("id-ID").format(
                                        item.amount,
                                    )}
                                </p>
                            </div>
                            <p class="text-xs font-medium text-gray-400">
                                {item.date}
                            </p>
                        </div>
                    </div>
                ))
            }
        </div>

        <!-- Pagination -->
        <div
            class="flex items-center justify-between mt-6 pt-6 border-t border-gray-100"
        >
            <span class="text-xs font-bold text-gray-400"
                >Menampilkan 1-20 dari 150 transaksi</span
            >
            <div class="flex gap-2">
                <button
                    disabled
                    class="px-4 py-2 rounded-xl border border-gray-200 text-gray-400 font-bold text-xs cursor-not-allowed bg-gray-50"
                    >Previous</button
                >
                <button
                    class="px-4 py-2 rounded-xl bg-gray-800 text-white font-bold text-xs hover:bg-gray-900 transition-all shadow-lg shadow-gray-200"
                    >Next</button
                >
            </div>
        </div>
    </div>
</DashboardLayout>
