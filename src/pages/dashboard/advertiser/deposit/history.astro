---
import DashboardLayout from "../../../../layouts/DashboardLayout.astro";

// TypeScript interface for deposit history item (Astro v5 best practice)
interface DepositItem {
    id: string;
    method: string;
    amount: number;
    date: string;
    status: "success" | "pending" | "failed";
}

// Mock Data
const depositHistory: DepositItem[] = Array.from({ length: 20 }).map(
    (_, i) => ({
        id: `DEP-${20000 + i}`,
        method: [
            "QRIS",
            "BCA VA",
            "Mandiri VA",
            "BRI VA",
            "Dana",
            "OVO",
            "ShopeePay",
        ][Math.floor(Math.random() * 7)],
        amount: (Math.floor(Math.random() * 20) + 1) * 50000,
        date: new Date(
            Date.now() - Math.floor(Math.random() * 1000 * 60 * 60 * 24 * 30),
        ).toLocaleDateString("id-ID", {
            day: "numeric",
            month: "short",
            year: "numeric",
        }),
        status: (["success", "pending", "failed"] as const)[
            Math.floor(Math.random() * (i < 5 ? 2 : 3))
        ],
    }),
);

function getMethodColorBg(method: string): string {
    if (
        method.includes("BCA") ||
        method.includes("Mandiri") ||
        method.includes("BRI") ||
        method.includes("VA")
    )
        return "bg-blue-50 text-blue-600";
    if (method.includes("Dana")) return "bg-sky-50 text-sky-600";
    if (method.includes("OVO")) return "bg-purple-50 text-purple-600";
    if (method.includes("GoPay")) return "bg-green-50 text-green-600";
    if (method.includes("Shopee")) return "bg-orange-50 text-orange-600";
    return "bg-gray-50 text-gray-600";
}
---

<DashboardLayout title="Riwayat Deposit">
    <!-- BEGIN: Hero Section -->
    <section class="mb-4 md:mb-8">
        <div
            class="flex flex-col md:flex-row md:items-end justify-between gap-4"
        >
            <div>
                <h1
                    class="text-2xl md:text-4xl font-bold text-gray-800 mb-1 md:mb-2"
                >
                    Riwayat Deposit
                </h1>
                <p class="text-gray-400 font-light text-base md:text-lg">
                    Pantau semua transaksi deposit masuk Anda disini.
                </p>
            </div>
            <div class="flex gap-3">
                <a
                    href="/dashboard/advertiser/deposit"
                    class="px-5 py-2.5 rounded-xl bg-[#ff6b6b] text-white font-bold text-sm hover:bg-[#e55a5a] transition-all flex items-center gap-2 shadow-lg shadow-red-100"
                >
                    <i class="fa-solid fa-plus"></i>
                    Deposit Baru
                </a>
                <button
                    class="px-5 py-2.5 rounded-xl bg-white text-gray-800 font-bold text-sm hover:bg-gray-50 transition-all flex items-center gap-2 border border-gray-200"
                >
                    <i class="fa-solid fa-download"></i>
                    Export CSV
                </button>
            </div>
        </div>
    </section>
    <!-- END: Hero Section -->

    <!-- BEGIN: Main Card -->
    <div class="soft-card p-4 md:p-6">
        <!-- Desktop Table View -->
        <div class="overflow-x-auto hidden md:block">
            <table class="w-full min-w-[600px] text-left border-collapse">
                <thead>
                    <tr
                        class="text-[10px] text-gray-400 uppercase tracking-wider border-b border-gray-100"
                    >
                        <th class="pb-3 font-medium">ID Transaksi</th>
                        <th class="pb-3 font-medium">Metode</th>
                        <th class="pb-3 font-medium">Tanggal</th>
                        <th class="pb-3 font-medium text-right">Nominal</th>
                        <th class="pb-3 font-medium text-right">Status</th>
                    </tr>
                </thead>
                <tbody class="text-sm">
                    {
                        depositHistory.map((item) => (
                            <tr class="group hover:bg-gray-50 transition-colors border-b border-gray-50 last:border-0">
                                <td class="py-4 font-mono text-xs text-gray-400 group-hover:text-gray-800 transition-colors">
                                    #{item.id}
                                </td>
                                <td class="py-4">
                                    <div class="flex items-center gap-3">
                                        <div
                                            class={`w-8 h-8 rounded-lg ${getMethodColorBg(item.method)} flex items-center justify-center`}
                                        >
                                            {item.method.includes("VA") ||
                                            item.method.includes("Bank") ? (
                                                <i class="fa-solid fa-building-columns text-xs" />
                                            ) : (
                                                <i class="fa-solid fa-wallet text-xs" />
                                            )}
                                        </div>
                                        <span class="font-bold text-sm text-gray-800">
                                            {item.method}
                                        </span>
                                    </div>
                                </td>
                                <td class="py-4 text-sm font-medium text-gray-500">
                                    {item.date}
                                </td>
                                <td class="py-4 text-right font-black text-sm text-emerald-600">
                                    + Rp{" "}
                                    {new Intl.NumberFormat("id-ID").format(
                                        item.amount,
                                    )}
                                </td>
                                <td class="py-4 text-right">
                                    {item.status === "success" && (
                                        <span class="px-3 py-1 rounded-full text-[10px] font-bold bg-emerald-50 text-emerald-500">
                                            <span class="inline-block w-1.5 h-1.5 bg-emerald-500 rounded-full mr-1 animate-pulse" />
                                            Berhasil
                                        </span>
                                    )}
                                    {item.status === "pending" && (
                                        <span class="px-3 py-1 rounded-full text-[10px] font-bold bg-amber-50 text-amber-500">
                                            <span class="inline-block w-1.5 h-1.5 bg-amber-500 rounded-full mr-1" />
                                            Proses
                                        </span>
                                    )}
                                    {item.status === "failed" && (
                                        <span class="px-3 py-1 rounded-full text-[10px] font-bold bg-red-50 text-red-500">
                                            Gagal
                                        </span>
                                    )}
                                </td>
                            </tr>
                        ))
                    }
                </tbody>
            </table>
        </div>

        <!-- Mobile Card View -->
        <div class="md:hidden space-y-4">
            {
                depositHistory.map((item) => (
                    <div class="p-4 rounded-xl border border-gray-100 bg-gray-50/50 hover:bg-gray-50 transition-all">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex items-center gap-3">
                                <div
                                    class={`w-10 h-10 rounded-xl ${getMethodColorBg(item.method)} flex items-center justify-center`}
                                >
                                    {item.method.includes("VA") ||
                                    item.method.includes("Bank") ? (
                                        <i class="fa-solid fa-building-columns" />
                                    ) : (
                                        <i class="fa-solid fa-wallet" />
                                    )}
                                </div>
                                <div>
                                    <h4 class="font-bold text-sm text-gray-800">
                                        {item.method}
                                    </h4>
                                    <p class="text-[10px] text-gray-400 font-mono">
                                        #{item.id}
                                    </p>
                                </div>
                            </div>
                            {item.status === "success" && (
                                <span class="px-2 py-1 rounded-full text-[10px] font-bold bg-emerald-50 text-emerald-500">
                                    Berhasil
                                </span>
                            )}
                            {item.status === "pending" && (
                                <span class="px-2 py-1 rounded-full text-[10px] font-bold bg-amber-50 text-amber-500">
                                    Proses
                                </span>
                            )}
                            {item.status === "failed" && (
                                <span class="px-2 py-1 rounded-full text-[10px] font-bold bg-red-50 text-red-500">
                                    Gagal
                                </span>
                            )}
                        </div>
                        <div class="flex items-end justify-between border-t border-gray-200/50 pt-3">
                            <div>
                                <p class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-0.5">
                                    Nominal
                                </p>
                                <p class="font-black text-base text-emerald-600">
                                    + Rp{" "}
                                    {new Intl.NumberFormat("id-ID").format(
                                        item.amount,
                                    )}
                                </p>
                            </div>
                            <p class="text-xs font-medium text-gray-400">
                                {item.date}
                            </p>
                        </div>
                    </div>
                ))
            }
        </div>

        <!-- Pagination -->
        <div
            class="flex items-center justify-between mt-6 pt-6 border-t border-gray-100"
        >
            <span class="text-xs font-bold text-gray-400"
                >Menampilkan 1-20 dari 150 transaksi</span
            >
            <div class="flex gap-2">
                <button
                    disabled
                    class="px-4 py-2 rounded-xl border border-gray-200 text-gray-400 font-bold text-xs cursor-not-allowed"
                    >Previous</button
                >
                <button
                    class="px-4 py-2 rounded-xl bg-[#ff6b6b] text-white font-bold text-xs hover:bg-[#e55a5a] transition-all"
                    >Next</button
                >
            </div>
        </div>
    </div>
    <!-- END: Main Card -->
</DashboardLayout>
