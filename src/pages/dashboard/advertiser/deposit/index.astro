---
import DashboardLayout from "../../../../layouts/DashboardLayout.astro";
import DepositStatus from "../../../../components/dashboard/deposit/DepositStatus.astro";

// Mock Data
const ppobBalance = 1500000;
const campaignBalance = 1000000;

const paymentMethods = [
    { name: "QRIS", icon: "qr-code", fee: "0.7%" },
    { name: "Virtual Account", icon: "building-library", fee: "Rp 2.500" },
    { name: "E-Wallet", icon: "wallet", fee: "1.5%" },
];
---

<DashboardLayout title="Deposit Saldo">
    <!-- Header -->
    <div
        class="mb-8 flex flex-col md:flex-row md:items-end justify-between gap-4"
    >
        <div>
            <h1 class="text-2xl font-bold text-white tracking-tight">
                Deposit Saldo
            </h1>
            <p class="text-gray-400 text-sm mt-1">
                Isi saldo akun Anda untuk memulai transaksi.
            </p>
        </div>
    </div>

    <!-- MAIN GRID -->
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 relative z-10">
        <!-- LEFT COLUMN (Form) - lg:col-span-7 -->
        <div class="lg:col-span-7 space-y-6">
            <!-- Balance Card (Split) -->
            <!-- Balance Card (Split) -->
            <div
                class="bg-gradient-to-br from-[#0C1A18] to-[#142925] rounded-[2rem] p-8 border border-[#1F3D36] relative overflow-hidden shadow-2xl group grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-12"
            >
                <div
                    class="absolute top-0 right-0 w-64 h-64 bg-emerald-500/10 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 group-hover:bg-emerald-500/20 transition-all duration-700"
                >
                </div>
                <div
                    class="absolute bottom-0 left-0 w-32 h-32 bg-[#D4F24F]/5 rounded-full blur-2xl translate-y-1/2 -translate-x-1/2"
                >
                </div>

                <!-- Saldo PPOB Section (Inner Card) -->
                <div
                    class="relative z-10 flex flex-col justify-between gap-4 bg-[#D4F24F]/15 rounded-2xl p-5 border border-[#D4F24F]/30"
                >
                    <div class="flex justify-between items-start">
                        <div class="p-2.5 bg-[#D4F24F]/20 rounded-xl">
                            <svg
                                class="w-6 h-6 text-[#D4F24F]"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                                ><path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"
                                ></path></svg
                            >
                        </div>
                    </div>
                    <div>
                        <p
                            class="text-gray-400 font-bold text-xs uppercase tracking-wider mb-1"
                        >
                            Saldo PPOB
                        </p>
                        <h2
                            class="text-3xl font-black text-white tracking-tight leading-none"
                            id="display-ppob-balance"
                        >
                            Rp 1.500<span class="text-gray-600/50">.000</span>
                        </h2>
                        <div class="mt-2 h-6" id="est-ppob-container">
                            <!-- Estimated balance will appear here -->
                        </div>
                    </div>
                </div>

                <!-- Saldo Iklan Section (Inner Card) -->
                <div
                    class="relative z-10 flex flex-col justify-between gap-4 bg-blue-500/15 rounded-2xl p-5 border border-blue-500/30"
                >
                    <div class="flex justify-between items-start">
                        <div class="p-2.5 bg-blue-500/20 rounded-xl">
                            <svg
                                class="w-6 h-6 text-blue-500"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                                ><path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"
                                ></path></svg
                            >
                        </div>
                    </div>
                    <div>
                        <p
                            class="text-gray-400 font-bold text-xs uppercase tracking-wider mb-1"
                        >
                            Saldo Iklan
                        </p>
                        <h2
                            class="text-3xl font-black text-white tracking-tight leading-none"
                            id="display-campaign-balance"
                        >
                            Rp 1.000<span class="text-gray-600/50">.000</span>
                        </h2>
                        <div class="mt-2 h-6" id="est-campaign-container">
                            <!-- Estimated balance will appear here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Deposit Form Card -->
            <div
                class="bg-white rounded-[2rem] p-6 md:p-8 border border-gray-200 shadow-sm"
            >
                <h3 class="text-lg font-bold text-[#0C1A18] mb-6">
                    Tujuan Deposit
                </h3>

                <!-- Deposit Type Selection -->
                <div class="grid grid-cols-2 gap-4 mb-8">
                    <!-- Type: PPOB -->
                    <button
                        type="button"
                        class="deposit-type-btn relative group p-1 rounded-2xl border-2 border-[#D4F24F] bg-[#D4F24F]/5 transition-all text-left ring-2 ring-[#D4F24F]/20"
                        onclick="selectDepositType(this, 'ppob')"
                        data-type="ppob"
                    >
                        <div
                            class="h-full bg-white/50 rounded-xl p-4 flex flex-col justify-between gap-3 relative overflow-hidden"
                        >
                            <!-- Background Decor -->
                            <div
                                class="absolute top-0 right-0 w-20 h-20 bg-[#D4F24F]/20 rounded-full blur-xl -translate-y-1/2 translate-x-1/2"
                            >
                            </div>

                            <div class="flex justify-between items-start z-10">
                                <div
                                    class="w-10 h-10 rounded-full bg-[#D4F24F]/20 flex items-center justify-center text-[#0C1A18]"
                                >
                                    <svg
                                        class="w-5 h-5"
                                        fill="none"
                                        stroke="currentColor"
                                        viewBox="0 0 24 24"
                                        ><path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"
                                        ></path></svg
                                    >
                                </div>
                                <div
                                    class="w-5 h-5 rounded-full bg-[#D4F24F] text-[#0C1A18] flex items-center justify-center shadow-sm check-icon"
                                >
                                    <svg
                                        class="w-3 h-3"
                                        fill="none"
                                        stroke="currentColor"
                                        viewBox="0 0 24 24"
                                        ><path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="3"
                                            d="M5 13l4 4L19 7"></path></svg
                                    >
                                </div>
                            </div>
                            <div class="z-10">
                                <h4
                                    class="font-bold text-[#0C1A18] leading-tight"
                                >
                                    Pulsa & PPOB
                                </h4>
                                <p
                                    class="text-[10px] text-gray-500 mt-1 font-medium"
                                >
                                    Transaksi produk digital
                                </p>
                            </div>
                        </div>
                    </button>

                    <!-- Type: Campaign -->
                    <button
                        type="button"
                        class="deposit-type-btn relative group p-1 rounded-2xl border-2 border-transparent bg-white hover:bg-gray-50 transition-all text-left"
                        onclick="selectDepositType(this, 'campaign')"
                        data-type="campaign"
                    >
                        <div
                            class="h-full bg-transparent rounded-xl p-4 flex flex-col justify-between gap-3 relative overflow-hidden"
                        >
                            <!-- Background Decor -->
                            <div
                                class="absolute top-0 right-0 w-20 h-20 bg-blue-500/0 group-hover:bg-blue-500/10 rounded-full blur-xl -translate-y-1/2 translate-x-1/2 transition-all"
                            >
                            </div>

                            <div class="flex justify-between items-start z-10">
                                <div
                                    class="w-10 h-10 rounded-full bg-blue-50 text-blue-500 flex items-center justify-center group-hover:scale-110 transition-transform"
                                >
                                    <svg
                                        class="w-5 h-5"
                                        fill="none"
                                        stroke="currentColor"
                                        viewBox="0 0 24 24"
                                        ><path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"
                                        ></path></svg
                                    >
                                </div>
                                <div
                                    class="w-5 h-5 rounded-full bg-blue-500 text-white flex items-center justify-center shadow-sm opacity-0 scale-50 transition-all check-icon"
                                >
                                    <svg
                                        class="w-3 h-3"
                                        fill="none"
                                        stroke="currentColor"
                                        viewBox="0 0 24 24"
                                        ><path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="3"
                                            d="M5 13l4 4L19 7"></path></svg
                                    >
                                </div>
                            </div>
                            <div class="z-10">
                                <h4
                                    class="font-bold text-gray-400 group-hover:text-[#0C1A18] transition-colors leading-tight"
                                >
                                    Campaign / Iklan
                                </h4>
                                <p
                                    class="text-[10px] text-gray-400 mt-1 font-medium"
                                >
                                    Topup saldo beriklan
                                </p>
                            </div>
                        </div>
                    </button>
                </div>

                <h3 class="text-lg font-bold text-[#0C1A18] mb-6">
                    Metode Pembayaran
                </h3>

                <!-- Method Selection -->
                <div class="grid grid-cols-2 gap-3 mb-6">
                    {
                        paymentMethods.map((m) => (
                            <button
                                type="button"
                                class="method-btn relative group p-4 rounded-2xl border border-gray-200 hover:border-[#0C1A18] hover:bg-gray-50 transition-all text-left focus:border-[#D4F24F] focus:ring-2 focus:ring-[#D4F24F]/20"
                                onclick={`selectMethod(this, '${m.name}')`}
                            >
                                <div class="mb-3 text-gray-400 group-hover:text-[#0C1A18] transition-colors method-icon flex justify-between items-start">
                                    {m.icon === "qr-code" && (
                                        <svg
                                            class="w-6 h-6"
                                            fill="none"
                                            stroke="currentColor"
                                            viewBox="0 0 24 24"
                                        >
                                            <path
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                                stroke-width="2"
                                                d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"
                                            />
                                        </svg>
                                    )}
                                    {m.icon === "building-library" && (
                                        <svg
                                            class="w-6 h-6"
                                            fill="none"
                                            stroke="currentColor"
                                            viewBox="0 0 24 24"
                                        >
                                            <path
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                                stroke-width="2"
                                                d="M8 14v3m4-3v3m4-3v3M3 21h18M3 10h18M3 7l9-4 9 4M4 10h16v11H4V10z"
                                            />
                                        </svg>
                                    )}
                                    {m.icon === "wallet" && (
                                        <svg
                                            class="w-6 h-6"
                                            fill="none"
                                            stroke="currentColor"
                                            viewBox="0 0 24 24"
                                        >
                                            <path
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                                stroke-width="2"
                                                d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"
                                            />
                                        </svg>
                                    )}
                                    <div class="w-5 h-5 rounded-full bg-[#0C1A18] text-white flex items-center justify-center opacity-0 scale-50 transition-all check-icon">
                                        <svg
                                            class="w-3 h-3"
                                            fill="none"
                                            stroke="currentColor"
                                            viewBox="0 0 24 24"
                                        >
                                            <path
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                                stroke-width="3"
                                                d="M5 13l4 4L19 7"
                                            />
                                        </svg>
                                    </div>
                                </div>
                                <p class="font-bold text-sm text-[#0C1A18]">
                                    {m.name}
                                </p>
                                <p class="text-[10px] text-gray-500 font-medium">
                                    Fee: {m.fee}
                                </p>
                            </button>
                        ))
                    }
                </div>

                <form class="space-y-5" onsubmit="return false;">
                    <!-- Amount Input -->
                    <div class="space-y-1.5">
                        <label
                            class="text-[10px] font-bold text-gray-500 uppercase tracking-wider ml-1"
                            >Nominal Deposit</label
                        >
                        <div class="relative">
                            <span
                                class="absolute left-5 top-1/2 -translate-y-1/2 text-gray-400 font-bold pointer-events-none text-xl"
                                >Rp</span
                            >
                            <input
                                type="number"
                                id="deposit-amount"
                                class="w-full bg-gray-50 text-[#0C1A18] font-black text-2xl pl-14 pr-6 py-4 rounded-xl border border-gray-200 focus:border-[#0C1A18] focus:bg-white transition-all outline-none placeholder:text-gray-200"
                                placeholder="0"
                            />
                        </div>
                        <div class="flex gap-2 justify-end">
                            <span class="text-[10px] text-gray-400 font-bold"
                                >Min: Rp 10.000</span
                            >
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="pt-4 border-t border-gray-100 mt-6">
                        <div class="flex justify-between items-center mb-6">
                            <span class="text-sm font-bold text-gray-500"
                                >Total Pembayaran</span
                            >
                            <h3
                                class="text-2xl font-black text-[#0C1A18]"
                                id="total-payment"
                            >
                                Rp 0
                            </h3>
                        </div>
                        <button
                            type="button"
                            onclick="processDeposit()"
                            class="w-full py-4 bg-[#0C1A18] hover:bg-[#152A26] text-white font-bold rounded-xl shadow-lg transition-all flex items-center justify-center gap-2 text-base transform active:scale-[0.98]"
                        >
                            <svg
                                class="w-5 h-5"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                                ><path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"
                                ></path></svg
                            >
                            Bayar Sekarang
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- RIGHT COLUMN (Empty / Info Only) - lg:col-span-5 -->
        <div class="lg:col-span-5 space-y-6">
            <!-- Info Box -->
            <div class="bg-[#142925] rounded-2xl p-6 border border-[#1F3D36]">
                <div class="flex items-start gap-4">
                    <div class="p-2 bg-[#D4F24F]/10 rounded-lg text-[#D4F24F]">
                        <svg
                            class="w-6 h-6"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                            ><path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                            ></path></svg
                        >
                    </div>
                    <div>
                        <h4 class="text-white font-bold text-sm mb-1">
                            Layanan Otomatis 24/7
                        </h4>
                        <ul
                            class="text-gray-400 text-xs space-y-2 list-disc pl-4 leading-relaxed"
                        >
                            <li>
                                Deposit diproses secara otomatis oleh sistem.
                            </li>
                            <li>Minimal deposit Rp 10.000.</li>
                            <li>Simpan bukti transfer jika diperlukan.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <DepositStatus />

    <script is:inline>
        let currentAmount = 0;

        // Balances from Backend (Mock)
        const ppobBalance = 1500000;
        const campaignBalance = 1000000;

        // --- CORE FUNCTIONS ---

        function moveModalsToBody() {
            const ids = ["deposit-status-modal"];
            ids.forEach((id) => {
                const el = document.getElementById(id);
                if (el && el.parentElement !== document.body) {
                    document.body.appendChild(el);
                }
            });
        }

        const amountInput = document.getElementById("deposit-amount");
        if (amountInput) {
            amountInput.addEventListener("input", (e) => {
                currentAmount = parseInt(e.target.value) || 0;
                updateUI();
            });
        }

        function updateUI() {
            // Update Total Payment
            const totalEl = document.getElementById("total-payment");
            if (totalEl)
                totalEl.innerText =
                    "Rp " +
                    new Intl.NumberFormat("id-ID").format(currentAmount);

            // Clear previous estimations
            const estPPOB = document.getElementById("est-ppob-container");
            const estCampaign = document.getElementById(
                "est-campaign-container",
            );
            if (estPPOB) estPPOB.innerHTML = "";
            if (estCampaign) estCampaign.innerHTML = "";

            if (currentAmount > 0) {
                const targetContainer =
                    selectedDepositType === "ppob" ? estPPOB : estCampaign;
                const baseBalance =
                    selectedDepositType === "ppob"
                        ? ppobBalance
                        : campaignBalance;
                const total = baseBalance + currentAmount;
                const formatted = new Intl.NumberFormat("id-ID").format(total);
                const colorClass =
                    selectedDepositType === "ppob"
                        ? "text-[#D4F24F]"
                        : "text-blue-400";

                if (targetContainer) {
                    targetContainer.innerHTML = `
                        <div class="flex items-center gap-1.5 animate-pulse">
                            <span class="text-[10px] text-gray-400 font-medium">Estimasi:</span>
                            <span class="text-sm font-bold ${colorClass}">Rp ${formatted}</span>
                             <svg class="w-3 h-3 ${colorClass}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>
                        </div>
                     `;
                }
            }
        }

        let selectedDepositType = "ppob"; // Default

        function selectDepositType(btn, type) {
            document.querySelectorAll(".deposit-type-btn").forEach((b) => {
                const isPPOB = b.dataset.type === "ppob";
                const isCampaign = b.dataset.type === "campaign";

                // Reset base classes
                b.classList.remove(
                    "border-[#D4F24F]",
                    "bg-[#D4F24F]/5",
                    "ring-2",
                    "ring-[#D4F24F]/20",
                );
                b.classList.remove(
                    "border-blue-500",
                    "bg-blue-500/5",
                    "ring-blue-500/20",
                );
                b.classList.add("border-transparent", "bg-white");

                // Reset Text Colors
                const title = b.querySelector("h4");
                if (title) {
                    title.classList.remove("text-[#0C1A18]");
                    title.classList.add("text-gray-400");
                }

                // Reset Check Icon
                const check = b.querySelector(".check-icon");
                if (check) {
                    check.classList.remove("opacity-100", "scale-100");
                    check.classList.add("opacity-0", "scale-50");
                }
            });

            // Activate Selected
            selectedDepositType = type;
            btn.classList.remove("border-transparent", "bg-white");

            const title = btn.querySelector("h4");
            if (title) {
                title.classList.remove("text-gray-400");
                title.classList.add("text-[#0C1A18]");
            }

            const check = btn.querySelector(".check-icon");
            if (check) {
                check.classList.remove("opacity-0", "scale-50");
                check.classList.add("opacity-100", "scale-100");
            }

            if (type === "ppob") {
                btn.classList.add(
                    "border-[#D4F24F]",
                    "bg-[#D4F24F]/5",
                    "ring-2",
                    "ring-[#D4F24F]/20",
                );
            } else {
                btn.classList.add(
                    "border-blue-500",
                    "bg-blue-50",
                    "ring-2",
                    "ring-blue-500/20",
                );
            }

            // Recalculate estimation
            updateUI();
        }

        function selectMethod(btn, name) {
            document.querySelectorAll(".method-btn").forEach((b) => {
                b.classList.remove(
                    "border-[#0C1A18]",
                    "ring-2",
                    "ring-[#0C1A18]/5",
                );
                b.classList.add("border-gray-200");
                const check = b.querySelector(".check-icon");
                if (check) {
                    check.classList.remove("opacity-100", "scale-100");
                    check.classList.add("opacity-0", "scale-50");
                }
            });

            btn.classList.remove("border-gray-200");
            btn.classList.add("border-[#0C1A18]", "ring-2", "ring-[#0C1A18]/5");
            const check = btn.querySelector(".check-icon");
            if (check) {
                check.classList.remove("opacity-0", "scale-50");
                check.classList.add("opacity-100", "scale-100");
            }

            selectedMethod = name;
        }

        function processDeposit() {
            if (currentAmount < 10000) {
                showToast("Minimal deposit Rp 10.000", "error");
                return;
            }
            if (!selectedMethod) {
                showToast("Silakan pilih metode pembayaran", "error");
                return;
            }

            toggleModal("deposit-status-modal", true);
            const loading = document.getElementById("status-loading");
            if (loading) {
                loading.classList.remove("hidden");
                loading.classList.add("flex");
            }

            ["status-success", "status-pending", "status-failed"].forEach(
                (id) => {
                    const el = document.getElementById(id);
                    if (el) {
                        el.classList.add("hidden");
                        el.classList.remove("flex");
                    }
                },
            );

            setTimeout(() => {
                if (loading) {
                    loading.classList.remove("flex");
                    loading.classList.add("hidden");
                }
                const resId = "status-pending"; // Default pending
                const resEl = document.getElementById(resId);
                if (resEl) {
                    resEl.classList.remove("hidden");
                    resEl.classList.add("flex");
                }
            }, 2000);
        }

        // --- HISTORY MODAL LOGIC (reused) ---
        function toggleModal(modalId, show) {
            const modal = document.getElementById(modalId);
            if (!modal) return;

            if (show) {
                modal.classList.remove("hidden");
                setTimeout(() => {
                    const backdrop = modal.querySelector(
                        "div[id$='-backdrop']",
                    );
                    const panel =
                        modal.querySelector("div[id$='-panel']") ||
                        modal.querySelector("#status-content");
                    if (backdrop)
                        backdrop.classList.replace("opacity-0", "opacity-100");
                    if (panel) {
                        panel.classList.replace("opacity-0", "opacity-100");
                        if (panel.classList.contains("scale-95"))
                            panel.classList.replace("scale-95", "scale-100");
                        if (panel.classList.contains("scale-90"))
                            panel.classList.replace("scale-90", "scale-100");
                    }
                }, 10);
            } else {
                const backdrop = modal.querySelector("div[id$='-backdrop']");
                const panel =
                    modal.querySelector("div[id$='-panel']") ||
                    modal.querySelector("#status-content");
                if (backdrop)
                    backdrop.classList.replace("opacity-100", "opacity-0");
                if (panel) {
                    panel.classList.replace("opacity-100", "opacity-0");
                    if (panel.classList.contains("scale-100"))
                        panel.classList.replace("scale-100", "scale-95");
                }
                setTimeout(() => {
                    modal.classList.add("hidden");
                }, 300);
            }
        }

        window.closeStatusModal = function () {
            toggleModal("deposit-status-modal", false);
        };

        // --- TOAST NOTIFICATION ---
        function showToast(message, type = "success") {
            // Remove existing
            const existing = document.getElementById("dynamic-toast");
            if (existing) existing.remove();

            // Create Element
            const toast = document.createElement("div");
            toast.id = "dynamic-toast";

            const isError = type === "error";
            const iconColor = isError ? "text-red-500" : "text-[#D4F24F]";
            const bgColor = isError ? "bg-red-500/10" : "bg-[#D4F24F]/10";
            const borderColor = isError
                ? "border-red-500/50"
                : "border-[#1F3D36]";
            const title = isError ? "Gagal" : "Berhasil";
            const iconPath = isError
                ? "M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                : "M5 13l4 4L19 7";

            // FORCE STYLE with inline style
            toast.style.cssText =
                "position: fixed; top: 24px; right: 24px; z-index: 2147483647 !important; transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1); transform: translateY(-150%); opacity: 0; pointer-events: none;";

            // Mobile adjustment
            if (window.innerWidth < 768) {
                toast.style.left = "50%";
                toast.style.right = "auto";
                toast.style.transform = "translate(-50%, -150%)";
            }

            toast.innerHTML = `
                <div class="bg-[#0C1A18] border ${borderColor} text-white px-5 py-4 rounded-xl shadow-2xl flex items-center gap-3 min-w-[300px] backdrop-blur-md">
                    <div class="w-8 h-8 rounded-full ${bgColor} flex items-center justify-center flex-shrink-0">
                        <svg class="w-5 h-5 ${iconColor}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${iconPath}"></path></svg>
                    </div>
                    <div>
                        <h4 class="font-bold text-sm text-white">${title}</h4>
                        <p class="text-[11px] text-gray-400 mt-0.5">${message}</p>
                    </div>
                </div>
            `;

            document.body.appendChild(toast);

            // Animate In
            setTimeout(() => {
                toast.style.opacity = "1";
                toast.style.pointerEvents = "auto";

                if (window.innerWidth < 768) {
                    toast.style.transform = "translate(-50%, 0)";
                } else {
                    toast.style.transform = "translateY(0)";
                }
            }, 50);

            // Animate Out
            setTimeout(() => {
                toast.style.opacity = "0";
                toast.style.pointerEvents = "none";
                if (window.innerWidth < 768) {
                    toast.style.transform = "translate(-50%, -150%)";
                } else {
                    toast.style.transform = "translateY(-150%)";
                }

                setTimeout(() => {
                    if (toast && toast.parentElement) toast.remove();
                }, 500);
            }, 3000);
        }

        document.addEventListener("astro:page-load", () => {
            moveModalsToBody();
        });
        moveModalsToBody();
    </script>
</DashboardLayout>
