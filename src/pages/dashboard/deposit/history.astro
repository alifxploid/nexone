---
import DashboardLayout from "../../../layouts/DashboardLayout.astro";

// Mock Data (Shared with Index logic, ideally moved to a store/utils)
const depositHistory = Array.from({ length: 20 }).map((_, i) => ({
    id: `DEP-${20000 + i}`,
    method: [
        "QRIS",
        "BCA VA",
        "Mandiri VA",
        "BRI VA",
        "Dana",
        "OVO",
        "ShopeePay",
    ][Math.floor(Math.random() * 7)],
    amount: (Math.floor(Math.random() * 20) + 1) * 50000,
    date: new Date(
        Date.now() - Math.floor(Math.random() * 1000 * 60 * 60 * 24 * 30),
    ).toLocaleDateString("id-ID", {
        day: "numeric",
        month: "short",
        year: "numeric",
    }),
    status: ["success", "pending", "failed"][
        Math.floor(Math.random() * (i < 5 ? 2 : 3))
    ],
}));

function getMethodColorBg(method: string) {
    if (
        method.includes("BCA") ||
        method.includes("Mandiri") ||
        method.includes("BRI") ||
        method.includes("VA")
    )
        return "bg-blue-50 text-blue-600";
    if (method.includes("Dana")) return "bg-sky-50 text-sky-600";
    if (method.includes("OVO")) return "bg-purple-50 text-purple-600";
    if (method.includes("GoPay")) return "bg-green-50 text-green-600";
    if (method.includes("Shopee")) return "bg-orange-50 text-orange-600";
    return "bg-gray-50 text-gray-600";
}

function getMethodIcon(method: string) {
    if (method.includes("VA") || method.includes("Bank"))
        return `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 14v3m4-3v3m4-3v3M3 21h18M3 10h18M3 7l9-4 9 4M4 10h16v11H4V10z"/></svg>`;
    return `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg>`;
}

function getStatusBadge(status: string) {
    if (status === "success")
        return `<span class="inline-flex items-center gap-1 text-[10px] font-bold text-emerald-600 bg-emerald-50 px-2 py-1 rounded-lg border border-emerald-100"><span class="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"></span>Berhasil</span>`;
    if (status === "pending")
        return `<span class="inline-flex items-center gap-1 text-[10px] font-bold text-amber-600 bg-amber-50 px-2 py-1 rounded-lg border border-amber-100"><span class="w-1.5 h-1.5 rounded-full bg-amber-500"></span>Proses</span>`;
    return `<span class="inline-flex items-center gap-1 text-[10px] font-bold text-red-600 bg-red-50 px-2 py-1 rounded-lg border border-red-100">Gagal</span>`;
}
---

<DashboardLayout title="Riwayat Deposit">
    <!-- Header -->
    <div
        class="mb-8 flex flex-col md:flex-row md:items-end justify-between gap-4"
    >
        <div>
            <h1 class="text-2xl font-bold text-white tracking-tight">
                Riwayat Deposit
            </h1>
            <p class="text-gray-400 text-sm mt-1">
                Pantau semua transaksi deposit masuk Anda disini.
            </p>
        </div>
        <div class="flex gap-3">
            <a
                href="/dashboard/deposit"
                class="px-5 py-2.5 rounded-xl bg-[#D4F24F] text-[#0C1A18] font-bold text-sm hover:bg-[#cbf029] transition-all flex items-center gap-2 shadow-[0_0_15px_rgba(212,242,79,0.3)] hover:shadow-[0_0_20px_rgba(212,242,79,0.5)]"
            >
                <svg
                    class="w-4 h-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    ><path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg
                >
                Deposit Baru
            </a>
            <button
                class="px-5 py-2.5 rounded-xl bg-[#0C1A18] text-white font-bold text-sm shadow-lg shadow-[#0C1A18]/20 hover:bg-[#152A26] transition-all flex items-center gap-2 border border-[#1F3D36]"
            >
                <svg
                    class="w-4 h-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    ><path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"
                    ></path></svg
                >
                Export CSV
            </button>
        </div>
    </div>

    <!-- Main Card -->
    <div
        class="bg-white rounded-[2rem] p-6 md:p-8 border border-gray-200 shadow-sm"
    >
        <div class="overflow-x-auto hidden md:block">
            <table class="w-full">
                <thead>
                    <tr class="text-left border-b border-gray-100">
                        <th
                            class="pb-4 text-xs font-bold text-gray-400 uppercase tracking-wider"
                            >ID Transaksi</th
                        >
                        <th
                            class="pb-4 text-xs font-bold text-gray-400 uppercase tracking-wider"
                            >Metode</th
                        >
                        <th
                            class="pb-4 text-xs font-bold text-gray-400 uppercase tracking-wider"
                            >Tanggal</th
                        >
                        <th
                            class="pb-4 text-xs font-bold text-gray-400 uppercase tracking-wider text-right"
                            >Nominal</th
                        >
                        <th
                            class="pb-4 text-xs font-bold text-gray-400 uppercase tracking-wider text-right"
                            >Status</th
                        >
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-50">
                    {
                        depositHistory.map((item) => (
                            <tr class="group hover:bg-gray-50/50 transition-colors">
                                <td class="py-4 font-mono text-xs text-gray-400 group-hover:text-[#0C1A18] transition-colors">
                                    #{item.id}
                                </td>
                                <td class="py-4">
                                    <div class="flex items-center gap-3">
                                        <div
                                            class={`w-8 h-8 rounded-lg ${getMethodColorBg(item.method)} flex items-center justify-center`}
                                        >
                                            <Fragment
                                                set:html={getMethodIcon(
                                                    item.method,
                                                )}
                                            />
                                        </div>
                                        <span class="font-bold text-sm text-[#0C1A18]">
                                            {item.method}
                                        </span>
                                    </div>
                                </td>
                                <td class="py-4 text-sm font-medium text-gray-500">
                                    {item.date}
                                </td>
                                <td class="py-4 text-right font-black text-sm text-[#0C1A18]">
                                    + Rp{" "}
                                    {new Intl.NumberFormat("id-ID").format(
                                        item.amount,
                                    )}
                                </td>
                                <td class="py-4 text-right">
                                    <Fragment
                                        set:html={getStatusBadge(item.status)}
                                    />
                                </td>
                            </tr>
                        ))
                    }
                </tbody>
            </table>
        </div>

        <!-- Mobile Card View -->
        <div class="md:hidden space-y-4">
            {
                depositHistory.map((item) => (
                    <div class="p-4 rounded-xl border border-gray-100 bg-gray-50/50 hover:bg-gray-50 transition-all">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex items-center gap-3">
                                <div
                                    class={`w-10 h-10 rounded-xl ${getMethodColorBg(item.method)} flex items-center justify-center`}
                                >
                                    <Fragment
                                        set:html={getMethodIcon(item.method)}
                                    />
                                </div>
                                <div>
                                    <h4 class="font-bold text-sm text-[#0C1A18]">
                                        {item.method}
                                    </h4>
                                    <p class="text-[10px] text-gray-400 font-mono">
                                        #{item.id}
                                    </p>
                                </div>
                            </div>
                            <Fragment set:html={getStatusBadge(item.status)} />
                        </div>
                        <div class="flex items-end justify-between border-t border-gray-200/50 pt-3">
                            <div>
                                <p class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-0.5">
                                    Nominal
                                </p>
                                <p class="font-black text-base text-[#0C1A18]">
                                    Rp{" "}
                                    {new Intl.NumberFormat("id-ID").format(
                                        item.amount,
                                    )}
                                </p>
                            </div>
                            <p class="text-xs font-medium text-gray-400">
                                {item.date}
                            </p>
                        </div>
                    </div>
                ))
            }
        </div>

        <!-- Pagination -->
        <div
            class="flex items-center justify-between mt-6 pt-6 border-t border-gray-100"
        >
            <span class="text-xs font-bold text-gray-400"
                >Menampilkan 1-20 dari 150 transaksi</span
            >
            <div class="flex gap-2">
                <button
                    disabled
                    class="px-4 py-2 rounded-xl border border-gray-200 text-gray-400 font-bold text-xs cursor-not-allowed"
                    >Previous</button
                >
                <button
                    class="px-4 py-2 rounded-xl bg-[#0C1A18] text-white font-bold text-xs hover:bg-[#152A26] transition-all"
                    >Next</button
                >
            </div>
        </div>
    </div>
</DashboardLayout>
